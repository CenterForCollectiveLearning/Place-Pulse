function onStreetViewChoice(e){if(uiLocked)return;uiLocked=!0;var t={study_id:study_id,left:locs[0].id,right:locs[1].id,choice:e};GAMIFICATION_STATUS.numVotes+=1;if(typeof GAMIFICATION_STATUS!="undefined")if(GAMIFICATION_STATUS.numVotes==GAMIFICATION_STATUS.nextStudy.votesToUnlock){t.gamification_status=!0;updateNextStudy(GAMIFICATION_STATUS,"#voteSuccessLink");$("#voteSuccess").show()}else{updateVoteCount(GAMIFICATION_STATUS);$("#voteSuccess").hide()}$.ajax({type:"POST",url:"/study/vote/"+study_id+"/",data:t,success:function(e){getImagesFromBuffer();loadImagesToBuffer();if(e.gamificationStatus){GAMIFICATION_STATUS=e.gamificationStatus;updateNextStudy(GAMIFICATION_STATUS);updateVoteCount(GAMIFICATION_STATUS)}}})}function getImagesFromBuffer(){var e=$("#pano_left_buffer img.place").attr("src"),t=$("#pano_right_buffer img.place").attr("src");$("#pano_left img.place").attr("src",e);$("#pano_right img.place").attr("src",t);locs=locs_buffer}function loadImagesToBuffer(){$.ajax({url:"/study/getpair/"+study_id,type:"GET",success:function(e){locs_buffer=e.locs;$("#pano_left_buffer img.place").attr("src",getSVURL(locs_buffer[0].loc[0],locs_buffer[0].loc[1]));$("#pano_right_buffer img.place").attr("src",getSVURL(locs_buffer[1].loc[0],locs_buffer[1].loc[1]));uiLocked=!1}})}function init(){$.ajax({url:"/study/getpair/"+study_id,type:"GET",success:function(e){locs=e.locs;$("#pano_left img.place").attr("src",getSVURL(locs[0].loc[0],locs[0].loc[1]));$("#pano_right img.place").attr("src",getSVURL(locs[1].loc[0],locs[1].loc[1]));loadImagesToBuffer()}});if(typeof GAMIFICATION_STATUS=="undefined")$("#voteProgress").hide();else{updateVoteCount(GAMIFICATION_STATUS);updateNextStudy(GAMIFICATION_STATUS)}}function updateVoteCount(e){var t=e.numVotes-e.lastUnlockedAt,n=e.nextStudy.votesToUnlock-e.lastUnlockedAt;$("#votesRemaining").html(n-t);$(".progress .bar").css("width",(t/n*100).toString()+"%")}function updateNextStudy(e,t){t||(t="#nextStudyToUnlock");var n=$('<a href=""></a>');n.attr("_target","_blank");n.attr("href","/study/results/"+e.nextStudy.studyID);n.text(e.nextStudy.studyQuestion);$(t).html(n)}function getSVURL(e,t){return"http://maps.googleapis.com/maps/api/streetview?size=470x306&location="+e+","+t+"&sensor=false"}var locs_buffer,locs,buffer_left,buffer_right,uiLocked=!0,numVotes=0;